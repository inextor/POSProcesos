<div class="container-fluid">
	<h1 class="my-3">Articulos disponibles por tienda</h1>
	<button (click)="openModal()" class="btn btn-primary mb-3">Add New</button>

	<div class="card-body">
		<form (submit)="search()" class="mb-3">
			<div class="row">
				<div class="col-md-4">
					<div class="form-group">
						<label for="item_id">Item ID</label>
						<input type="number" class="form-control" id="item_id" name="item_id" [(ngModel)]="search_object.eq.item_id">
					</div>
				</div>
				<div class="col-md-4">
					<div class="form-group">
						<label for="store_id">Store ID</label>
						<input type="number" class="form-control" id="store_id" name="store_id" [(ngModel)]="search_object.eq.store_id">
					</div>
				</div>
				<div class="col-md-4">
					<button type="submit" class="btn btn-primary mt-4">Search</button>
				</div>
			</div>
		</form>

		<div class="table-responsive">
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>ID</th>
						<th>Item ID</th>
						<th>Item Name</th>
						<th>Store</th>
						<th>POS Preference</th>
						<th>Available Online</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let i of citem_store">
						<td>{{ i.item_store.id }}</td>
						<td>{{ i.item_store.item_id }}</td>
						<td>{{ i.item.name }}</td>
						<td>{{ i.store.name }}</td>
						<td>{{ i.item_store.pos_preference }}</td>
						<td>{{ i.item_store.is_available_online }}</td>
						<td>
							<a [routerLink]="['/edit-item-store', i.item_store.id]" class="btn btn-sm btn-warning">Edit</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" [class.show]="show_modal" [style.display]="show_modal ? 'block' : 'none'" tabindex="-1" role="dialog" *ngIf="show_modal">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Agregar Artículo a Tienda</h5>
				<button type="button" class="close" (click)="closeModal()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!-- Search Item -->
				<div class="form-group">
					<label for="item_search">Buscar Artículo</label>
					<input
						type="text"
						class="form-control"
						id="item_search"
						[(ngModel)]="item_search"
						(ngModelChange)="onSearchInput()"
						placeholder="Ingrese nombre o código del artículo (mínimo 2 caracteres)">
				</div>

				<!-- Item Results -->
				<div class="item-results mb-3" *ngIf="item_list.length > 0 && !selected_item">
					<label>Resultados (máximo 5):</label>
					<div class="list-group">
						<button
							type="button"
							class="list-group-item list-group-item-action"
							*ngFor="let item of item_list"
							(click)="selectItem(item)">
							<div class="d-flex w-100 justify-content-between">
								<h6 class="mb-1">{{ item.name }}</h6>
								<small>ID: {{ item.id }}</small>
							</div>
							<small *ngIf="item.code">Código: {{ item.code }}</small>
							<!--small *ngIf="item.category" class="d-block text-muted">Categoría: {{ item_info.category.name }}</small-->
						</button>
					</div>
				</div>

				<!-- Selected Item Display -->
				<div class="alert alert-success" *ngIf="selected_item">
					<div class="d-flex justify-content-between align-items-center">
						<div>
							<strong>Artículo Seleccionado:</strong> {{ selected_item.name }} (ID: {{ selected_item.id }})
							<!--span *ngIf="selected_item.category" class="d-block text-muted">Categoría: {{ selected_item.category.name }}</span-->
						</div>
						<button type="button" class="btn btn-sm btn-outline-secondary" (click)="clearSelection()">
							Cambiar
						</button>
					</div>
				</div>

				<!-- Store Selection -->
				<div class="form-group">
					<label for="modal_store_id">Tienda *</label>
					<select
						class="form-control"
						id="modal_store_id"
						[(ngModel)]="new_item_store.store_id"
						[class.is-invalid]="new_item_store.store_id === 0"
						required>
						<option [value]="0" disabled selected>Seleccione una tienda</option>
						<option *ngFor="let s of store_list" [value]="s.id">{{ s.name }}</option>
					</select>
					<div class="invalid-feedback" *ngIf="new_item_store.store_id === 0">
						Debe seleccionar una tienda
					</div>
				</div>

				<!-- POS Preference Selection -->
				<div class="form-group">
					<label for="modal_pos_preference">Preferencia POS *</label>
					<select
						class="form-control"
						id="modal_pos_preference"
						[(ngModel)]="new_item_store.pos_preference"
						required>
						<option value="SHOW">Mostrar</option>
						<option value="HIDE">Ocultar</option>
						<option value="DEFAULT">Default</option>
					</select>
				</div>

				<!-- Available Online -->
				<div class="form-group">
					<label for="modal_available_online">Disponible en línea</label>
					<select
						class="form-control"
						id="modal_available_online"
						[(ngModel)]="new_item_store.is_available_online">
						<option [value]="null">Sin especificar</option>
						<option [value]="1">Sí</option>
						<option [value]="0">No</option>
					</select>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
				<button type="button" class="btn btn-primary" (click)="saveItemStore()" [disabled]="!selected_item || !new_item_store.store_id || new_item_store.store_id === 0">
					Guardar
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade" [class.show]="show_modal" *ngIf="show_modal"></div>
